<html>
    <head>
        <style>
        #display {

            padding: 30px;
            height: 90%;
            width: 100%;
            border: 1px solid black;
        }
        </style>
        <script src="/socket.io/socket.io.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="/javascripts/chat.js"></script>
        <script src="/javascripts/chat_ui.js"></script>
    </head>

    <body>
        <script>
        var socket = io.connect();

        $(function(){

            var chat_ui = new ChatApp.ChatUI(socket);

            socket.on("nicknames", function(data){
                $("#users").html(data.nicknames + "-- Room: " + data.room + "\n");
            });

            socket.on("newguest", function(data){
                $("#display").append("<pre>" + data.newguest + "</pre>");
            });

            socket.on("leftmessage", function(data){
                $("#display").append("<pre>" + data.message + "</pre>");
            });

            socket.on("message", function(data){
                $space = $("#display");
                chat_ui.display($space, data.nickname + " : " + data.message);

            });



             socket.on("nicknameChangeResult",function(data){
                if(data.success){
                    $("#display").append("<pre>"+"("+ "Nickname change success!"+ ")"+ "\n"+ "</pre>");
                    return;
                } else {
                    $("#display").append("<pre>"+ "("+ data.message+ ")" + "\n"+ "</pre>");
                    return;
                }
            });

            $("form").on("submit", function(event){
                event.preventDefault();

                var $form = $(event.currentTarget);
                chat_ui.getMessage($form);
                chat_ui.sendMessage();
               $(event.currentTarget).find("textarea#input").val("");
            });

            $("a").on("click", function(event){
                event.preventDefault();
                var a = $(event.currentTarget).attr("href");
                var text = "/room " + a;

                chat_ui.chat.processCommand(text);
            });
        });
        </script>
        <pre><div id="display">
            <b>[Rooms: <a href="lobby">lobby</a>,
                <a href="java">java</a>,
                <a href="c">c</a>,
                <a href="ruby">ruby</a>,
                <a href="python">python</a>]</b>

            <br>
          <b>  Users in this room: <div id="users"></div></b>
        </div></pre>

        <form>
            <textarea id="input" name="message"></textarea>
            <input type="submit" value="Submit">
        </form>
    </body>
</html>